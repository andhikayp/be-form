// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  userId                 String          @id @unique @db.VarChar(30)
  username               String          @db.VarChar(100)
  corporateAccountNumber String          @db.VarChar(12)
  corporateName          String          @db.VarChar(100)
  role                   String          @db.VarChar(20)
  phoneNumber            String          @db.VarChar(15)
  password               String          @db.VarChar(100)
  verificationCode       String?         @db.VarChar(6) // Assuming verificationCode is optional
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  GroupTransfers         GroupTransfer[]
  Transactions           Transaction[]   @relation("UserTransactions")

  @@map("users")
}

model GroupTransfer {
  referenceNumber String        @id @default(uuid())
  totalAmount     Int? // optional
  totalRecord     Int? // optional
  sourceAccount   String        @db.VarChar(12)
  makerUserId     String
  status          String        @db.VarChar(15)
  createdAt       DateTime      @default(now())
  Transactions    Transaction[]

  makerUser User @relation(fields: [makerUserId], references: [userId])

  @@map("group_transfers")
}

model Transaction {
  id                     Int       @id @default(autoincrement())
  amount                 Int
  groupTransferId        String    @default(uuid())
  sourceAccount          String?   @db.VarChar(12) // optional
  destinationAccount     String    @db.VarChar(12)
  destinationBankName    String    @db.VarChar(50)
  destinationAccountName String    @db.VarChar(100)
  date                   DateTime? // optional
  transferTime           DateTime? // optional, should be time but Prisma uses DateTime for all datetime fields
  makerUserId            String
  instructionType        String    @db.VarChar(20)
  transferType           String    @db.VarChar(20)
  createdAt              DateTime  @default(now())

  makerUser     User          @relation("UserTransactions", fields: [makerUserId], references: [userId])
  groupTransfer GroupTransfer @relation(fields: [groupTransferId], references: [referenceNumber])

  @@map("transactions")
}
